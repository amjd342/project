{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\\\u0627\\u0645\\u062C\\u062F \\u0627\\u0644\\u0633\\u0644\\u0645\\u064A\\\\OneDrive\\\\\\u0627\\u0644\\u0645\\u0633\\u062A\\u0646\\u062F\\u0627\\u062A\\\\GitHub\\\\project\\\\src\\\\context\\\\CartContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { useAuth } from './AuthContext';\nimport { getUserCart, addToCart as dbAddToCart, updateCartQuantity as dbUpdateQuantity, removeFromCart as dbRemoveFromCart, clearCart as dbClearCart, getProductById } from '../utils/database';\n\n// Create Cart Context\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CartContext = /*#__PURE__*/createContext(null);\n\n// Cart Provider Component\nexport const CartProvider = ({\n  children\n}) => {\n  _s();\n  const {\n    user,\n    isAuthenticated\n  } = useAuth();\n  const [cartItems, setCartItems] = useState([]);\n  const [loading, setLoading] = useState(false);\n\n  // Load cart when user changes\n  useEffect(() => {\n    if (isAuthenticated() && user) {\n      loadCart();\n    } else {\n      setCartItems([]);\n    }\n  }, [user]);\n\n  // Load user's cart from database\n  const loadCart = () => {\n    if (!user) return;\n    const cart = getUserCart(user.id);\n    // Enrich cart items with product details\n    const enrichedCart = cart.map(item => {\n      const product = getProductById(item.productId);\n      return {\n        ...item,\n        product\n      };\n    }).filter(item => item.product); // Remove items with deleted products\n\n    setCartItems(enrichedCart);\n  };\n\n  // Add item to cart\n  const addToCart = (productId, quantity = 1) => {\n    if (!user) {\n      return {\n        success: false,\n        error: 'يجب تسجيل الدخول أولاً - Please login first'\n      };\n    }\n    setLoading(true);\n    try {\n      dbAddToCart(user.id, productId, quantity);\n      loadCart();\n      return {\n        success: true\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Update item quantity\n  const updateQuantity = (productId, quantity) => {\n    if (!user) return {\n      success: false\n    };\n    setLoading(true);\n    try {\n      dbUpdateQuantity(user.id, productId, quantity);\n      loadCart();\n      return {\n        success: true\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Remove item from cart\n  const removeFromCart = productId => {\n    if (!user) return {\n      success: false\n    };\n    setLoading(true);\n    try {\n      dbRemoveFromCart(user.id, productId);\n      loadCart();\n      return {\n        success: true\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Clear entire cart\n  const clearCart = () => {\n    if (!user) return {\n      success: false\n    };\n    setLoading(true);\n    try {\n      dbClearCart(user.id);\n      setCartItems([]);\n      return {\n        success: true\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Calculate cart totals\n  const getCartTotal = () => {\n    return cartItems.reduce((total, item) => {\n      var _item$product;\n      return total + (((_item$product = item.product) === null || _item$product === void 0 ? void 0 : _item$product.price) || 0) * item.quantity;\n    }, 0);\n  };\n\n  // Get total items count\n  const getItemCount = () => {\n    return cartItems.reduce((count, item) => count + item.quantity, 0);\n  };\n\n  // Check if product is in cart\n  const isInCart = productId => {\n    return cartItems.some(item => item.productId === productId);\n  };\n\n  // Get item quantity in cart\n  const getItemQuantity = productId => {\n    const item = cartItems.find(item => item.productId === productId);\n    return item ? item.quantity : 0;\n  };\n  const value = {\n    cartItems,\n    loading,\n    addToCart,\n    updateQuantity,\n    removeFromCart,\n    clearCart,\n    getCartTotal,\n    getItemCount,\n    isInCart,\n    getItemQuantity,\n    loadCart\n  };\n  return /*#__PURE__*/_jsxDEV(CartContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 151,\n    columnNumber: 5\n  }, this);\n};\n\n// Custom hook to use cart context\n_s(CartProvider, \"HIly0ZFO7zSx5TLdZgrxRQ/Ugpg=\", false, function () {\n  return [useAuth];\n});\n_c = CartProvider;\nexport const useCart = () => {\n  _s2();\n  const context = useContext(CartContext);\n  if (!context) {\n    throw new Error('useCart must be used within a CartProvider');\n  }\n  return context;\n};\n_s2(useCart, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport default CartContext;\nvar _c;\n$RefreshReg$(_c, \"CartProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useAuth","getUserCart","addToCart","dbAddToCart","updateCartQuantity","dbUpdateQuantity","removeFromCart","dbRemoveFromCart","clearCart","dbClearCart","getProductById","jsxDEV","_jsxDEV","CartContext","CartProvider","children","_s","user","isAuthenticated","cartItems","setCartItems","loading","setLoading","loadCart","cart","id","enrichedCart","map","item","product","productId","filter","quantity","success","error","message","updateQuantity","getCartTotal","reduce","total","_item$product","price","getItemCount","count","isInCart","some","getItemQuantity","find","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useCart","_s2","context","Error","$RefreshReg$"],"sources":["C:/Users/امجد السلمي/OneDrive/المستندات/GitHub/project/src/context/CartContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { useAuth } from './AuthContext';\r\nimport {\r\n  getUserCart,\r\n  addToCart as dbAddToCart,\r\n  updateCartQuantity as dbUpdateQuantity,\r\n  removeFromCart as dbRemoveFromCart,\r\n  clearCart as dbClearCart,\r\n  getProductById\r\n} from '../utils/database';\r\n\r\n// Create Cart Context\r\nconst CartContext = createContext(null);\r\n\r\n// Cart Provider Component\r\nexport const CartProvider = ({ children }) => {\r\n  const { user, isAuthenticated } = useAuth();\r\n  const [cartItems, setCartItems] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Load cart when user changes\r\n  useEffect(() => {\r\n    if (isAuthenticated() && user) {\r\n      loadCart();\r\n    } else {\r\n      setCartItems([]);\r\n    }\r\n  }, [user]);\r\n\r\n  // Load user's cart from database\r\n  const loadCart = () => {\r\n    if (!user) return;\r\n    \r\n    const cart = getUserCart(user.id);\r\n    // Enrich cart items with product details\r\n    const enrichedCart = cart.map(item => {\r\n      const product = getProductById(item.productId);\r\n      return {\r\n        ...item,\r\n        product\r\n      };\r\n    }).filter(item => item.product); // Remove items with deleted products\r\n    \r\n    setCartItems(enrichedCart);\r\n  };\r\n\r\n  // Add item to cart\r\n  const addToCart = (productId, quantity = 1) => {\r\n    if (!user) {\r\n      return { success: false, error: 'يجب تسجيل الدخول أولاً - Please login first' };\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      dbAddToCart(user.id, productId, quantity);\r\n      loadCart();\r\n      return { success: true };\r\n    } catch (error) {\r\n      return { success: false, error: error.message };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Update item quantity\r\n  const updateQuantity = (productId, quantity) => {\r\n    if (!user) return { success: false };\r\n\r\n    setLoading(true);\r\n    try {\r\n      dbUpdateQuantity(user.id, productId, quantity);\r\n      loadCart();\r\n      return { success: true };\r\n    } catch (error) {\r\n      return { success: false, error: error.message };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Remove item from cart\r\n  const removeFromCart = (productId) => {\r\n    if (!user) return { success: false };\r\n\r\n    setLoading(true);\r\n    try {\r\n      dbRemoveFromCart(user.id, productId);\r\n      loadCart();\r\n      return { success: true };\r\n    } catch (error) {\r\n      return { success: false, error: error.message };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Clear entire cart\r\n  const clearCart = () => {\r\n    if (!user) return { success: false };\r\n\r\n    setLoading(true);\r\n    try {\r\n      dbClearCart(user.id);\r\n      setCartItems([]);\r\n      return { success: true };\r\n    } catch (error) {\r\n      return { success: false, error: error.message };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Calculate cart totals\r\n  const getCartTotal = () => {\r\n    return cartItems.reduce((total, item) => {\r\n      return total + (item.product?.price || 0) * item.quantity;\r\n    }, 0);\r\n  };\r\n\r\n  // Get total items count\r\n  const getItemCount = () => {\r\n    return cartItems.reduce((count, item) => count + item.quantity, 0);\r\n  };\r\n\r\n  // Check if product is in cart\r\n  const isInCart = (productId) => {\r\n    return cartItems.some(item => item.productId === productId);\r\n  };\r\n\r\n  // Get item quantity in cart\r\n  const getItemQuantity = (productId) => {\r\n    const item = cartItems.find(item => item.productId === productId);\r\n    return item ? item.quantity : 0;\r\n  };\r\n\r\n  const value = {\r\n    cartItems,\r\n    loading,\r\n    addToCart,\r\n    updateQuantity,\r\n    removeFromCart,\r\n    clearCart,\r\n    getCartTotal,\r\n    getItemCount,\r\n    isInCart,\r\n    getItemQuantity,\r\n    loadCart\r\n  };\r\n\r\n  return (\r\n    <CartContext.Provider value={value}>\r\n      {children}\r\n    </CartContext.Provider>\r\n  );\r\n};\r\n\r\n// Custom hook to use cart context\r\nexport const useCart = () => {\r\n  const context = useContext(CartContext);\r\n  if (!context) {\r\n    throw new Error('useCart must be used within a CartProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport default CartContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}